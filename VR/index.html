<!DOCTYPE html> 
<html lang="en"> 
<head> 
    <title>Escenario VR</title>
</head>
<body>
    
<canvas id="myCanvas">
    <!--El elemento HTML canvas se puede utilizar para dibujar gr치ficos a trav칠s de 
        secuencias de comandos (por lo general JavaScript ).-->
</canvas>

<!-- Aqu칤 va todo el c칩digo de three.js -->
<!-- script type="importmap" importa las librer칤as necesarias para three.js-->
<script type="importmap">  
{ 
        "imports":{ 
        "three": "./js/three.module.js", 
        "three/VRButton": "./js/VRButton.js" 
        } 
} 
</script>
<script type="module">  
    import * as THREE from 'three';  
    import { VRButton } from 'three/VRButton'; 
    //import {OrbitControls} from 'three/OrbitControls'; 
    //console.log(OrbitControls); 
    import Obj1 from './Objeto/Arbol navide침o.js';
    import Obj2 from './Objeto/Casa.js';
    import Obj3 from './Objeto/Hombre de nieve.js';
    import Obj4 from './Objeto/CoronaNavideno.js';
    import Obj5 from './Objeto/Copo de nieve.js';
    import Obj6 from './Objeto/Poste de luz.js';
    import Obj7 from './Objeto/Regalo.js';

    //Renderer - Realiza una conexi칩n entre el c칩digo y el canvas 
    var renderer = new THREE.WebGLRenderer({canvas: 
    document.getElementById('myCanvas'),antialias: true}); 
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight); 
    renderer.setClearColor(0x0097CC); 
    renderer.xr.enabled = true;
    ///////////////////////////////////////////////////////////// A침adir estas Dos lineas 
    renderer.xr.setReferenceSpaceType( 'local' );
    /////////////////////////////////////////// Para habilitar el VR 
    document.body.appendChild( renderer.domElement );
    ///////////////////////////////////////// A침adir estas Dos lineas 
    document.body.appendChild( VRButton.createButton( renderer ) );
    /////////////////////////// PAra habilitar el boton en el navegador 


// 游꿟 Creando nueva escena - Es el espacio donde se colocan los objetos
    var scene = new THREE.Scene();

//游꿘游꿘 Agregar una c치mara de perspectiva
    var camera = new THREE.PerspectiveCamera(70,window.innerWidth / window.innerHeight,0.1,2000
      );
    scene.add(camera);

    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFShadowMap;

    var light = new THREE.DirectionalLight(0x85A3FF, 1.2);
    light.position.set(-200,200,100);
    light.target.position.set(0,0,0);
    var heplper1 = new THREE.DirectionalLightHelper(light);
    //scene.add(heplper1);
    light.castShadow = true;
    light.shadow.bias = 0.001;
    light.shadow.mapSize.width = 1024;
    light.shadow.mapSize.height = 1024;

    light.shadow.camera.top = 520;
    light.shadow.camera.bottom = -520;
    light.shadow.camera.left = -600;
    light.shadow.camera.right = 600; 
    light.shadow.camera.visible = true;

    var directionalHelper = new THREE.CameraHelper(light.shadow.camera);
    //scene.add(directionalHelper);

    scene.add(light);

    var sl01 = new THREE.SpotLight (0xD6C52D,.5,0,.5,0.5,0.5);
    scene.add(sl01);
    sl01.target.position.set(90,0,80);
    scene.add(sl01.target);
    sl01.position.set(90,100,80);

    var sl02 = new THREE.SpotLight (0xD6C52D,.5,0,.5,0.5,0.5);
    scene.add(sl02);
    sl02.target.position.set(90,0,-6);
    scene.add(sl02.target);
    sl02.position.set(90,100,-6);

    var sl03 = new THREE.SpotLight (0xD6C52D,1,0,1.5,0.5,0.5);
    scene.add(sl03);
    sl03.target.position.set(0,0,-120);
    scene.add(sl03.target);
    sl03.position.set(0,100,-120);

     // Settings de la c치mara  
    camera.position.set(0, 40, 100); 
// A침adiendo los OrbitControls 
// var controls = new OrbitControls(camera, renderer.domElement); 
// controls.enableDamping = true; 
// controls.dampingFactor = 0.05;
// Espacio para colocar los objetos
    
    var planeGeometry = new THREE.PlaneGeometry(300,400);
    var planeMaterial = new THREE.MeshLambertMaterial({
        color: 0xFFFFFF, side: THREE.DoubleSide
    });
    var plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.rotation.set(1.57,0,0);
    plane.position.set(0,0,0);
    scene.add(plane);
    plane.receiveShadow = true;

    var g1= new THREE.PlaneGeometry(220,30,250,200);
    var m1 = new THREE.MeshLambertMaterial({ color: 0x94571B,side:  THREE.DoubleSide});
    var base1 = new THREE.Mesh(g1,m1);
    base1.position.set(0,.5,40);
    base1.rotation.set(1.57,0,0)
    scene.add(base1);
    base1.receiveShadow = true;

    var base2 = new THREE.Mesh(g1,m1);
    base2.position.set(0,.5,-50);
    base2.rotation.set(1.57,0,0)
    scene.add(base2);
    base2.receiveShadow = true;

    var g2= new THREE.PlaneGeometry(50,400,50,20);
    var m2 = new THREE.MeshLambertMaterial({ color: 0x94571B,side:  THREE.DoubleSide});
    var base4 = new THREE.Mesh(g2,m2);
    base4.position.set(0,.5,0);
    base4.rotation.set(1.57,0,0)
    scene.add(base4);
    base4.receiveShadow = true;

    //Objetos Importados
    var arbol = Obj1({x: 0, y: 0, z: -120});
    scene.add(arbol);

    var casa = Obj2({x: 100, y: 5, z: -50});
    casa.scale.set(2, 2, 2);
    casa.rotation.set(0,-1.57, 0);
    scene.add(casa);

    var casa2 = Obj2({x: 100, y: 5, z: 40});
    casa2.scale.set(2, 2, 2);
    casa2.rotation.set(0,-1.57, 0);
    scene.add(casa2);

    var coronaNavideno = Obj4({x:78, y: 35, z: -50});
    coronaNavideno.scale.set(2, 2, 2);
    coronaNavideno.rotation.set(1.57,0, 1.57);
    scene.add(coronaNavideno);

    var coronaNavideno2 = Obj4({x:78, y: 35, z: 40});
    coronaNavideno2.scale.set(2, 2, 2);
    coronaNavideno2.rotation.set(1.57,0, 1.57);
    scene.add(coronaNavideno2);

    var poste1 = Obj6({x: 90, y: 0, z: -6});
    poste1.scale.set(1, 1, 1);
    scene.add(poste1);

    var poste2 = Obj6({x: 90, y: 0, z: 80});
    poste2.scale.set(1, 1, 1);
    scene.add(poste2);

    var reg1 = Obj7({x: 0, y: 0, z: 0});
    reg1.scale.set(1,1,1);
    reg1.position.set(-80,5,-50);
    scene.add(reg1);

    var reg2 = Obj7({x: 0, y: 0, z: 0});
    reg2.scale.set(1,1,1);
    reg2.position.set(-68,5,-50);
    scene.add(reg2);

    var reg3 = Obj7({x: 0, y: 0, z: 0});
    reg3.scale.set(1,1,1);
    reg3.position.set(-56,5,-50);
    scene.add(reg3);

    var reg4 = Obj7({x: 0, y: 0, z: 0});
    reg4.scale.set(1,1,1);
    reg4.position.set(-80,5,-62);
    scene.add(reg4);

    var reg5 = Obj7({x: 0, y: 0, z: 0});
    reg5.scale.set(1,1,1);
    reg5.position.set(-68,5,-62);
    scene.add(reg5);

    var reg6 = Obj7({x: 0, y: 0, z: 0});
    reg6.scale.set(1,1,1);
    reg6.position.set(-56,5,-62);
    scene.add(reg6);

    var reg7 = Obj7({x: 0, y: 0, z: 0});
    reg7.scale.set(1,1,1);
    reg7.position.set(-80,5,-74);
    scene.add(reg7);

    var reg8 = Obj7({x: 0, y: 0, z: 0});
    reg8.scale.set(1,1,1);
    reg8.position.set(-68,5,-74);
    scene.add(reg8);

    var reg9 = Obj7({x: 0, y: 0, z: 0});
    reg9.scale.set(1,1,1);
    reg9.position.set(-56,5,-74);
    scene.add(reg9);

    var reg10 = Obj7({x: 0, y: 0, z: 0});
    reg10.scale.set(1,1,1);
    reg10.position.set(-75,20,-67);
    scene.add(reg10);

    var reg11 = Obj7({x: 0, y: 0, z: 0});
    reg11.scale.set(1,1,1);
    reg11.position.set(-63,20,-67);
    scene.add(reg11);

    var reg12 = Obj7({x: 0, y: 0, z: 0});
    reg12.scale.set(1,1,1);
    reg12.position.set(-75,20,-55);
    scene.add(reg12);

    var reg13 = Obj7({x: 0, y: 0, z: 0});
    reg13.scale.set(1,1,1);
    reg13.position.set(-63,20,-55);
    scene.add(reg13);

    var reg14 = Obj7({x: 0, y: 0, z: 0});
    reg14.scale.set(1,1,1);
    reg14.position.set(-70,35,-60);
    scene.add(reg14);

    var reg15 = Obj7({x: 0, y: 0, z: 0});
    reg15.scale.set(1,1,1);
    reg15.position.set(-80,5,30);
    scene.add(reg15);

    var reg16 = Obj7({x: 0, y: 0, z: 0});
    reg16.scale.set(1,1,1);
    reg16.position.set(-68,5,30);
    scene.add(reg16);

    var reg17 = Obj7({x: 0, y: 0, z: 0});
    reg17.scale.set(1,1,1);
    reg17.position.set(-56,5,30);
    scene.add(reg17);

    var reg18 = Obj7({x: 0, y: 0, z: 0});
    reg18.scale.set(1,1,1);
    reg18.position.set(-80,5,42);
    scene.add(reg18);

    var reg19 = Obj7({x: 0, y: 0, z: 0});
    reg19.scale.set(1,1,1);
    reg19.position.set(-68,5,42);
    scene.add(reg19);

    var reg20 = Obj7({x: 0, y: 0, z: 0});
    reg20.scale.set(1,1,1);
    reg20.position.set(-56,5,42);
    scene.add(reg20);

    var reg21 = Obj7({x: 0, y: 0, z: 0});
    reg21.scale.set(1,1,1);
    reg21.position.set(-80,5,54);
    scene.add(reg21);

    var reg22 = Obj7({x: 0, y: 0, z: 0});
    reg22.scale.set(1,1,1);
    reg22.position.set(-68,5,54);
    scene.add(reg22);

    var reg23 = Obj7({x: 0, y: 0, z: 0});
    reg23.scale.set(1,1,1);
    reg23.position.set(-56,5,54);
    scene.add(reg23);

    var reg24 = Obj7({x: 0, y: 0, z: 0});
    reg24.scale.set(1,1,1);
    reg24.position.set(-75,20,35);
    scene.add(reg24);

    var reg25 = Obj7({x: 0, y: 0, z: 0});
    reg25.scale.set(1,1,1);
    reg25.position.set(-63,20,35);
    scene.add(reg25);

    var reg26 = Obj7({x: 0, y: 0, z: 0});
    reg26.scale.set(1,1,1);
    reg26.position.set(-75,20,48);
    scene.add(reg26);

    var reg27 = Obj7({x: 0, y: 0, z: 0});
    reg27.scale.set(1,1,1);
    reg27.position.set(-63,20,48);
    scene.add(reg27);

    var reg28 = Obj7({x: 0, y: 0, z: 0});
    reg28.scale.set(1,1,1);
    reg28.position.set(-70,35,40);
    scene.add(reg28);

//游꿣游꿣Rendering y animaci칩n 
    function render (){ 
    renderer.render(scene, camera); 
    requestAnimationFrame(render); 
    } 
    renderer.setAnimationLoop( render ); 

</script>
</body>
</html>